/*
 * sine.c
 *
 * Created: 13.04.2024 02:59:51
 *  Author: mrcm7
 */ 

/*
 * This file provides efficient implementation of sine signal generator
 * sine_wave array contains 64 values, representing the first quadrant of the function (sin(x)+1)/2
 * Using the fact that the sin function is odd and periodic, whole period can be reconstructed
 * To reduce the error a phase shift was introduced
 * To be strict, equation of realized function is f(x) = 255 * (sin(PI / 128 * (x + 0.5)) + 1) / 2
 * Note that x is an integer and result is rounded to nearest integer
 *
 * function get_sine allows you to get f(x) for argument in range (0, 255)
 *
 * TL;DR: use function get_sine() with arguments in range (0, 255) to get sine wave oscillating in range (0, 255)
 */

#include "sine.h"

#define FULL_SINE

#ifndef FULL_SINE
static const uint8_t sine_wave[64] = {129,132,135,138,142,145,148,151,154,157,160,163,166,169,172,175,178,181,183,186,189,192,194,197,200,202,205,207,210,212,214,217,219,221,223,225,227,229,231,233,234,236,238,239,241,242,243,245,246,247,248,249,250,251,252,252,253,253,254,254,255,255,255,255};
#else
//static const uint8_t sine_wave[256] = {129,132,135,138,142,145,148,151,154,157,160,163,166,169,172,175,178,181,183,186,189,192,194,197,200,202,205,207,210,212,214,217,219,221,223,225,227,229,231,233,234,236,238,239,241,242,243,245,246,247,248,249,250,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,254,254,253,253,252,252,251,250,249,248,247,246,245,243,242,241,239,238,236,234,233,231,229,227,225,223,221,219,217,214,212,210,207,205,202,200,197,194,192,189,186,183,181,178,175,172,169,166,163,160,157,154,151,148,145,142,138,135,132,129,126,123,120,117,113,110,107,104,101,98,95,92,89,86,83,80,77,74,72,69,66,63,61,58,55,53,50,48,45,43,41,38,36,34,32,30,28,26,24,22,21,19,17,16,14,13,12,10,9,8,7,6,5,4,3,3,2,2,1,1,0,0,0,0,0,0,0,0,1,1,2,2,3,3,4,5,6,7,8,9,10,12,13,14,16,17,19,21,22,24,26,28,30,32,34,36,38,41,43,45,48,50,53,55,58,61,63,66,69,72,74,77,80,83,86,89,92,95,98,101,104,107,110,113,117,120,123,126};
static const uint8_t sine_wave[256] = {131,137,143,149,155,162,167,173,179,185,190,196,201,206,211,215,220,224,228,232,235,238,241,244,246,249,250,252,253,254,255,255,255,255,254,253,252,250,249,246,244,241,238,235,232,228,224,220,215,211,206,201,196,190,185,179,173,167,162,155,149,143,137,131,124,118,112,106,100,93,88,82,76,70,65,59,54,49,44,40,35,31,27,23,20,17,14,11,9,6,5,3,2,1,0,0,0,0,1,2,3,5,6,9,11,14,17,20,23,27,31,35,40,44,49,54,59,65,70,76,82,88,93,100,106,112,118,124,131,137,143,149,155,162,167,173,179,185,190,196,201,206,211,215,220,224,228,232,235,238,241,244,246,249,250,252,253,254,255,255,255,255,254,253,252,250,249,246,244,241,238,235,232,228,224,220,215,211,206,201,196,190,185,179,173,167,162,155,149,143,137,131,124,118,112,106,100,93,88,82,76,70,65,59,54,49,44,40,35,31,27,23,20,17,14,11,9,6,5,3,2,1,0,0,0,0,1,2,3,5,6,9,11,14,17,20,23,27,31,35,40,44,49,54,59,65,70,76,82,88,93,100,106,112,118,124};
#endif

uint8_t sine_get_value(uint8_t index)
{
	#ifndef FULL_SINE
	if (index <= 63)
	{
		return (sine_wave[index]);
	}
	else if (index <= 127)
	{
		return (sine_wave[127 - index]);
	}
	else if (index <= 191)
	{
		return (255 - sine_wave[index - 128]);
	}
	else
	{
		return (255 - sine_wave[255 - index]);
	}
	#else
	return (sine_wave[index]);
	#endif
}